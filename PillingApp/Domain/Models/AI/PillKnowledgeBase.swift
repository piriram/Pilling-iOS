import Foundation

/// 피임약 가이드라인 지식 베이스
/// 출처: 식품의약품안전처 허가 의약품 첨부문서 (머시론정 기준)
struct PillKnowledgeBase {

    // MARK: - 복용 누락 대응 규칙

    static let missedPillGuidelines = """
    # 복용 누락 시 대응 규칙

    ## 공통 원칙
    - 연속 7일 이상 복용 유지가 중요
    - 휴약 기간이 7일을 초과해서는 안 됨

    ## 12시간 이내 누락
    - 즉시 1정 복용
    - 다음 정제는 평소 시간에 복용
    - **피임 효과 유지**

    ## 12시간 초과 누락

    ### 1주차 누락 (1~7일)
    - 잊은 마지막 정제 즉시 복용 (2정 동시 복용 가능)
    - 이후 정상 복용
    - **7일간 콘돔 병행 필수**
    - 이전 7일 내 성관계 있었다면 임신 가능성 안내

    ### 2주차 누락 (8~14일)
    - 잊은 마지막 정제 즉시 복용
    - 직전 7일간 정상 복용했으면 추가 피임 불필요
    - 그렇지 않거나 2정 이상 누락 시 → **7일 차단피임**

    ### 3주차 누락 (15~21일)
    휴약 없이 조정 필요

    선택 ①
    - 잊은 마지막 정제 즉시 복용
    - 현재 포장 종료 후 **휴약 없이 새 포장 시작**

    선택 ②
    - 현재 포장 중단
    - 누락일 포함 7일 휴약 후 새 포장 시작

    ※ 이후 첫 휴약기에 출혈 없으면 임신 가능성 고려
    """

    // MARK: - 구토/설사 대응

    static let vomitingDiarrheaGuidelines = """
    # 구토·설사 발생 시

    - 복용 후 **3~4시간 이내 구토 → 흡수 실패**
    - 추가 1정 복용 필요
    - 추가 복용이 어렵다면 **복용 누락 규칙 적용**
    - 심한 위장장애 지속 시 **추가 피임 병행**
    """

    // MARK: - 절대 금기사항

    static let contraindicationsGuidelines = """
    # 절대 사용 금기 (즉시 복용 중단 및 의료진 상담)

    다음 중 하나라도 해당 시 복용 중단:

    - 정맥·동맥 혈전증 또는 병력
    - 35세 이상 흡연자
    - 국소 신경학적 증상이 있는 편두통
    - 중증 간질환 또는 간종양
    - 유방암 등 성호르몬 관련 악성종양
    - 진단되지 않은 질 출혈
    - 임신 또는 임신 의심
    - 수유부
    - C형 간염 DAA 병용 중
    - 유당 불내증(해당 제제에 한함)
    """

    // MARK: - 즉시 병원 안내 증상 (ACHES)

    static let emergencySymptoms = """
    # 즉시 병원 방문이 필요한 증상 (ACHES)

    다음 증상이 나타나면 즉시 응급실 또는 병원 방문:

    - **A**bdominal pain: 심한 복통
    - **C**hest pain: 갑작스러운 흉통·호흡곤란
    - **H**eadache: 심한 두통 또는 시야 이상
    - **E**ye problems: 시력 변화
    - **S**evere leg pain: 편측 다리 통증·부종

    이는 혈전증의 가능성이 있는 증상입니다.
    """

    // MARK: - 약물 상호작용

    static let drugInteractionsGuidelines = """
    # 약물 상호작용 (피임 실패 위험)

    다음 약물 복용 시 피임 효과 감소:

    - 리팜핀 (결핵 치료제)
    - 항경련제 (페니토인, 페노바르비탈, 카르바마제핀 등)
    - 세인트존스워트 (St. John's Wort)
    - 일부 HIV·C형간염 치료제
    - 모다피닐

    **병용 기간 + 중단 후 28일까지 차단피임 필수**
    """

    // MARK: - 기본 복용 원칙

    static let basicUsageGuidelines = """
    # 기본 복용 원칙

    - 1일 1정, 매일 대략 같은 시간에 복용
    - 물과 함께 복용
    - 포장에 표시된 순서대로 복용
    - 21일 연속 복용 + 7일 휴약
    - 휴약 기간 중 소퇴성 출혈 발생 가능
    - 출혈이 끝나지 않아도 8일째 새 포장 시작
    """

    // MARK: - 시작 시기 가이드

    static let startTimingGuidelines = """
    # 피임약 시작 시기

    ## 가장 권장되는 방법: 생리 시작 첫날
    생리 시작 첫날에 복용을 시작하는 방법이 가장 간단하고 안전합니다.

    장점:
    - 즉시 피임 효과
    - 임신 가능성 걱정이 가장 적음
    - 주기 관리가 쉬움
    - 부정출혈 가능성이 낮은 편

    ## 다른 시작 방법

    생리 2-5일째 시작:
    - 복용 가능
    - 첫 7일간 콘돔 병행 필요

    생리와 상관없이 바로 시작 (Quick start):
    - 임신 가능성이 없다고 판단되면 시작 가능
    - 첫 7일간 콘돔 병행 필수
    - 임신 여부가 불확실하면 2-3주 후 임신 테스트 권장

    ## 치료 목적(PCOS, PMS)
    - 가능하면 생리 첫날 시작이 가장 무난
    - 치료 목적에서는 생리 첫날이 아니어도 시작하는 경우가 많음
    - 이 경우에도 초기 7일은 추가 피임이 필요할 수 있음
    """

    // MARK: - 우울감 대응 가이드

    static let depressionGuidelines = """
    # 피임약 복용 후 우울감

    피임약에 들어 있는 호르몬 변화로 인해 일부 사람에서는 기분 저하, 우울감, 의욕 감소 같은 증상이 나타날 수 있습니다.

    ## 흔한 증상인가요?
    - 복용 초기 1-3개월 동안 기분 변화나 우울감이 나타나는 경우가 있음
    - 대부분은 시간이 지나면서 완화
    - 일부에서는 지속되거나 악화될 수 있음

    ## 상황별 대응

    A. 가벼운 기분 저하:
    - 평소보다 조금 우울함
    - 일상생활은 가능
    - 잠, 식사에 큰 변화 없음
    -> 2-3주 정도 경과 관찰 가능

    B. 일상에 영향이 있음:
    - 이유 없이 자주 울고 싶음
    - 무기력해서 일학업이 힘듦
    - 불안, 짜증이 눈에 띄게 증가
    -> 의료진 상담 권장, 약 변경이나 중단 고려

    C. 즉시 도움 필요:
    - 죽고 싶다는 생각
    - 자해 충동
    - 극심한 불안공황
    - 이전보다 우울이 급격히 심해짐
    -> 즉시 병원 방문 또는 1393(자살예방 상담전화)

    ## 도움이 될 수 있는 방법
    - 복용 시간을 취침 전으로 조정
    - 충분한 수면과 규칙적인 식사
    - 카페인알코올 줄이기
    - 지금 약 이름과 증상 시점을 기록해 두기

    ## 중요한 점
    - 피임약으로 인한 우울감은 개인차가 매우 큼
    - 다른 성분의 피임약으로 바꾸면 기분 부작용이 사라지는 경우도 많음
    - 증상을 혼자 참을 필요는 없음
    """

    // MARK: - 약물 변경 고려 기준

    static let switchingGuidelines = """
    # 피임약 변경을 고려할 수 있는 상황

    ## 1. 2-3개월 이상 지속되는 부작용
    다음 증상이 복용 2-3개월 이후에도 지속:
    - 우울감, 기분 저하
    - 불안, 짜증 증가
    - 성욕 감소
    - 지속적인 두통
    - 유방통, 유방 긴장감
    - 메스꺼움이 일상에 지장
    -> 다른 성분의 피임약으로 변경 고려

    ## 2. 일상 기능에 영향
    - 무기력으로 일상 유지가 어려움
    - 감정 기복이 커서 관계에 문제 발생
    - 수면식사 패턴이 눈에 띄게 변화
    -> 변경 상담 권장

    ## 3. 정신건강 관련 신호
    - 과거 우울증 또는 공황장애 병력
    - 피임약 시작 후 우울 증상이 명확히 악화
    - 이전에는 없던 감정 둔화, 무감동
    -> 피임약 변경 또는 중단을 의료진과 상의

    ## 4. 출혈 패턴 문제
    - 점상출혈파탄출혈이 3주기 이상 지속
    - 출혈량이 많아 일상 불편
    - 원래 규칙적이던 주기가 지속적으로 흐트러짐
    -> 제형 변경 고려

    ## 5. 피부체액 관련 불만
    - 여드름 악화
    - 체액 저류(부종)
    - 체중 변화가 지속적으로 불편
    -> 프로게스틴 종류가 다른 피임약으로 변경 고려

    ## 6. 복용 편의성 문제
    - 휴약 기간마다 불안
    - 자주 복용을 잊음
    - 일정이 불규칙해 시간 유지가 어려움
    -> 24+4 제형 또는 연속 복용 제형 변경 고려

    ## 중요 안내
    - 피임약 부작용은 개인차가 큼
    - 한 약이 안 맞아도 다른 약은 잘 맞는 경우가 흔함
    - 불편을 참고 버티는 것이 정답은 아님
    """

    // MARK: - Helper 메서드

    /// 복용 누락 시간에 따른 가이드라인 반환
    static func getMissedPillGuideline(delayHours: Double, cycleDay: Int) -> String {
        if delayHours <= 12 {
            return """
            **12시간 이내 누락**

            - 즉시 1정 복용
            - 다음 정제는 평소 시간에 복용
            - **피임 효과 유지**
            """
        }

        // 12시간 초과
        if cycleDay >= 1 && cycleDay <= 7 {
            // 1주차
            return """
            **12시간 초과 누락 - 1주차**

            - 잊은 마지막 정제 즉시 복용 (2정 동시 복용 가능)
            - 이후 정상 복용
            - **7일간 콘돔 병행 필수**
            - 이전 7일 내 성관계 있었다면 임신 가능성 안내
            """
        } else if cycleDay >= 8 && cycleDay <= 14 {
            // 2주차
            return """
            **12시간 초과 누락 - 2주차**

            - 잊은 마지막 정제 즉시 복용
            - 직전 7일간 정상 복용했으면 추가 피임 불필요
            - 그렇지 않거나 2정 이상 누락 시 → **7일 차단피임**
            """
        } else {
            // 3주차
            return """
            **12시간 초과 누락 - 3주차**

            휴약 없이 조정 필요:

            선택 ①
            - 잊은 마지막 정제 즉시 복용
            - 현재 포장 종료 후 **휴약 없이 새 포장 시작**

            선택 ②
            - 현재 포장 중단
            - 누락일 포함 7일 휴약 후 새 포장 시작

            ※ 이후 첫 휴약기에 출혈 없으면 임신 가능성 고려
            """
        }
    }

    /// 상황별 가이드라인 검색
    static func getGuideline(for topic: Topic) -> String {
        switch topic {
        case .missedPill:
            return missedPillGuidelines
        case .vomitingDiarrhea:
            return vomitingDiarrheaGuidelines
        case .contraindications:
            return contraindicationsGuidelines
        case .emergencySymptoms:
            return emergencySymptoms
        case .drugInteractions:
            return drugInteractionsGuidelines
        case .basicUsage:
            return basicUsageGuidelines
        }
    }

    /// 가이드라인 주제
    enum Topic {
        case missedPill
        case vomitingDiarrhea
        case contraindications
        case emergencySymptoms
        case drugInteractions
        case basicUsage
    }
}
