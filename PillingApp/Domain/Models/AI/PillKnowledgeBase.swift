import Foundation

/// 피임약 가이드라인 지식 베이스
/// 출처: 식품의약품안전처 허가 의약품 첨부문서 (머시론정 기준)
struct PillKnowledgeBase {

    // MARK: - 피임약 안내 개요

    static let generalEducationGuidelines = """
    # 피임약, 제대로 알고 선택하세요

    피임약은 임신을 예방하는 약이면서, 여성 호르몬을 조절해 다양한 건강 문제를 함께 개선할 수 있습니다.

    ## 기본 원리
    일반적으로 피임약에는 에스트로겐과 프로게스테론 두 가지 호르몬이 들어 있습니다.
    이 성분들이 배란을 억제하고, 수정 및 착상 과정을 막아 임신을 예방합니다.

    피임약 복용 중 나타나는 출혈은 생리와 다른, 호르몬 중단으로 인한 출혈입니다.

    ## 피임약은 언제부터 먹어야 하나요?
    가장 권장되는 시작 시점은 생리 시작 첫날입니다.
    이 시점에 시작하면 임신 가능성이 낮고, 부정출혈도 상대적으로 적습니다.

    생리와 상관없이 시작했다면 첫 7일간은 콘돔을 병행하는 것이 안전합니다.

    ## 피임약의 종류
    피임약은 크게 두 가지 기준으로 나뉩니다.

    1. 에스트로겐 용량 차이
    - 저용량: 부작용은 적을 수 있으나 부정출혈이 생길 수 있음
    - 고용량: 부정출혈은 적지만 메스꺼움이나 혈전 위험이 증가할 수 있음

    2. 프로게스테론 종류
    - 2세대, 3세대, 4세대로 구분
    - 세대가 높다고 무조건 더 좋은 것은 아님
    - 개인 체질에 따라 맞는 성분이 다름

    어떤 피임약이 "최고"라기보다, 본인에게 맞는 약을 찾는 것이 가장 중요합니다.

    ## 피임약 부작용
    흔한 부작용:
    - 메스꺼움
    - 부정출혈
    - 유방 통증
    - 두통

    대부분은 복용 후 2-3개월 내에 호전됩니다.

    중요한 부작용으로는 혈전증이 있습니다.
    다음 증상이 있다면 즉시 병원을 방문해야 합니다.
    - 한쪽 다리만 붓거나 통증이 있을 때
    - 갑자기 숨이 차거나 가슴 통증이 있을 때

    특히 다음에 해당하면 복용에 주의가 필요합니다.
    - 35세 이상 흡연 여성
    - 비만 + 흡연
    - 혈전 가족력이 있는 경우

    ## 피임약의 장점
    - 생리통 완화
    - 생리량 감소
    - 생리주기 조절
    - 여드름 개선
    - 생리 전 증후군 완화
    - 난소암, 자궁내막암 위험 감소

    원할 때 시작하고, 원할 때 중단할 수 있다는 점도 장점입니다.

    ## 올바른 복용 방법
    - 보통 21일 복용 + 7일 휴약
    - 또는 28일 연속 복용(위약 포함)

    하루라도 잊었다면:
    - 생각난 즉시 1정 복용
    - 다음 날은 원래 시간에 복용

    잦은 복용 누락은 피임 효과를 떨어뜨릴 수 있으므로 알람 설정을 권장합니다.

    ## 마지막으로
    피임약은 사람마다 맞는 정도가 다릅니다.
    한 번 안 맞았다고 바로 포기하지 말고 성분이 다른 피임약으로 바꿔보는 것도 방법입니다.
    궁금한 점은 약국이나 산부인과에서 전문가와 상의하세요.
    """

    // MARK: - 피임약 오해와 사실

    static let mythsGuidelines = """
    # 피임약에 대한 오해와 사실

    ## 흔한 오해
    - "피임약 먹으면 살찐다"
    - "6개월 먹으면 끊어야 한다"
    - "한 달 쉬어야 한다"
    - "피임약 먹으면 불임이 온다"
    - "수년 먹고 끊었더니 임신이 안 된다"

    이런 말들은 널리 퍼져 있지만, 절대적 정답처럼 확인된 내용은 아닙니다.

    ## 경구피임약 기본 이해
    먹는 피임약은 에스트로겐 + 프로게스틴이 들어 있는 호르몬 약입니다.
    피임뿐 아니라 호르몬 조절이 필요한 경우에도 사용됩니다.

    ## 세대 구분
    피임약은 보통 1세대~4세대로 분류합니다.
    - 1세대: 국내 사용이 거의 없음
    - 2세대/3세대: 약국에서 구매 가능한 경우가 많음
    - 4세대: 처방이 필요한 약들이 포함됨

    세대 구분은 주로 프로게스틴 종류 차이로 정해집니다.

    ## 세대별 특징 요약
    - 2세대: 부종, 여드름 부작용이 나타날 수 있음
    - 3세대: 위 부작용이 상대적으로 덜한 편
    - 4세대: 여드름/부종을 줄이도록 개발된 약들이 있음

    예시로 4세대에 해당하는 약들이 있으며, 여드름 완화 목적으로도 사용됩니다.

    ## 혈전증 위험
    혈전은 중요한 부작용입니다.
    복용 초기(특히 첫 달)에 상대적으로 높고 이후 감소하는 경향이 있습니다.

    다음 증상이 나타나면 즉시 진료가 필요합니다.
    - 한쪽 다리/팔의 심한 통증 또는 부종
    - 갑작스런 호흡곤란이나 가슴 통증

    위험 요인이 있는 경우에는 반드시 상담이 중요합니다.
    - 35세 이상 흡연
    - 비만 + 흡연
    - 혈전 가족력

    ## 용량에 대한 이해
    에스트로겐 용량이 조금 더 높으면 부정출혈이 덜할 수 있고,
    생리 미루기 목적에 유리할 수 있다는 보고가 있습니다.
    반대로 더 낮은 용량은 일부 부작용이 적을 수 있습니다.

    "용량이 낮으면 효과가 떨어지나요?"
    기본 복용법을 지키면 피임 효과는 유사하게 기대됩니다.

    ## 프로게스틴 단일 제제
    에스트로겐이 없는 프로게스틴 단일 제제도 있습니다.
    혈전 위험 측면 부담이 상대적으로 적다는 설명이 있습니다.
    다만 부정출혈이 더 잘 생길 수 있습니다.

    ## 카더라 정리
    1) "살찐다"
    예전 제제에서 부종이 더 흔해 체중 증가처럼 느껴지는 경우가 있었습니다.

    2) "불임이 온다"
    대부분은 복용을 중단하면 배란과 생리가 회복됩니다.
    임신이 어렵다면 다른 원인을 먼저 확인해야 합니다.

    3) "여드름/피부 뒤집힘"
    제제에 따라 차이가 있고, 원하면 3세대/4세대를 고려하기도 합니다.

    4) "우울감/기분 변화/성욕 변화"
    일부에서 기분 변화가 나타날 수 있습니다.
    필요 시 용량이 낮은 약이나 다른 제제로 변경을 고려합니다.

    5) "몇 년 먹으면 끊어야 한다/한 달 쉬어야 한다"
    정해진 복용 기간 제한은 없습니다.
    다만 부정출혈이 지속되는 경우에는 일시 중단을 고려할 수 있습니다.

    ## 마무리
    피임약은 종류가 많고 개인차가 큽니다.
    하나의 정답보다 본인에게 맞는 약을 찾는 것이 중요합니다.
    필요하면 약사나 의료진과 상의하세요.
    """

    // MARK: - 복용 누락 대응 규칙

    static let missedPillGuidelines = """
    # 복용 누락 시 대응 규칙

    ## 공통 원칙
    - 연속 7일 이상 복용 유지가 중요
    - 휴약 기간이 7일을 초과해서는 안 됨

    ## 12시간 이내 누락
    - 즉시 1정 복용
    - 다음 정제는 평소 시간에 복용
    - **피임 효과 유지**

    ## 12시간 초과 누락

    ### 1주차 누락 (1~7일)
    - 잊은 마지막 정제 즉시 복용 (2정 동시 복용 가능)
    - 이후 정상 복용
    - **7일간 콘돔 병행 필수**
    - 이전 7일 내 성관계 있었다면 임신 가능성 안내

    ### 2주차 누락 (8~14일)
    - 잊은 마지막 정제 즉시 복용
    - 직전 7일간 정상 복용했으면 추가 피임 불필요
    - 그렇지 않거나 2정 이상 누락 시 → **7일 차단피임**

    ### 3주차 누락 (15~21일)
    휴약 없이 조정 필요

    선택 ①
    - 잊은 마지막 정제 즉시 복용
    - 현재 포장 종료 후 **휴약 없이 새 포장 시작**

    선택 ②
    - 현재 포장 중단
    - 누락일 포함 7일 휴약 후 새 포장 시작

    ※ 이후 첫 휴약기에 출혈 없으면 임신 가능성 고려
    """

    // MARK: - 구토/설사 대응

    static let vomitingDiarrheaGuidelines = """
    # 구토·설사 발생 시

    - 복용 후 **3~4시간 이내 구토 → 흡수 실패**
    - 추가 1정 복용 필요
    - 추가 복용이 어렵다면 **복용 누락 규칙 적용**
    - 심한 위장장애 지속 시 **추가 피임 병행**
    """

    // MARK: - 절대 금기사항

    static let contraindicationsGuidelines = """
    # 절대 사용 금기 (즉시 복용 중단 및 의료진 상담)

    다음 중 하나라도 해당 시 복용 중단:

    - 정맥·동맥 혈전증 또는 병력
    - 35세 이상 흡연자
    - 국소 신경학적 증상이 있는 편두통
    - 중증 간질환 또는 간종양
    - 유방암 등 성호르몬 관련 악성종양
    - 진단되지 않은 질 출혈
    - 임신 또는 임신 의심
    - 수유부
    - C형 간염 DAA 병용 중
    - 유당 불내증(해당 제제에 한함)
    """

    // MARK: - 즉시 병원 안내 증상 (ACHES)

    static let emergencySymptoms = """
    # 즉시 병원 방문이 필요한 증상 (ACHES)

    다음 증상이 나타나면 즉시 응급실 또는 병원 방문:

    - **A**bdominal pain: 심한 복통
    - **C**hest pain: 갑작스러운 흉통·호흡곤란
    - **H**eadache: 심한 두통 또는 시야 이상
    - **E**ye problems: 시력 변화
    - **S**evere leg pain: 편측 다리 통증·부종

    이는 혈전증의 가능성이 있는 증상입니다.
    """

    // MARK: - 약물 상호작용

    static let drugInteractionsGuidelines = """
    # 약물 상호작용 (피임 실패 위험)

    다음 약물 복용 시 피임 효과 감소:

    - 리팜핀 (결핵 치료제)
    - 항경련제 (페니토인, 페노바르비탈, 카르바마제핀 등)
    - 세인트존스워트 (St. John's Wort)
    - 일부 HIV·C형간염 치료제
    - 모다피닐

    **병용 기간 + 중단 후 28일까지 차단피임 필수**
    """

    // MARK: - 기본 복용 원칙

    static let basicUsageGuidelines = """
    # 기본 복용 원칙

    - 1일 1정, 매일 대략 같은 시간에 복용
    - 물과 함께 복용
    - 포장에 표시된 순서대로 복용
    - 21일 연속 복용 + 7일 휴약
    - 휴약 기간 중 소퇴성 출혈 발생 가능
    - 출혈이 끝나지 않아도 8일째 새 포장 시작
    """

    // MARK: - 시작 시기 가이드

    static let startTimingGuidelines = """
    # 피임약 시작 시기

    ## 가장 권장되는 방법: 생리 시작 첫날
    생리 시작 첫날에 복용을 시작하는 방법이 가장 간단하고 안전합니다.

    장점:
    - 즉시 피임 효과
    - 임신 가능성 걱정이 가장 적음
    - 주기 관리가 쉬움
    - 부정출혈 가능성이 낮은 편

    ## 다른 시작 방법

    생리 2-5일째 시작:
    - 복용 가능
    - 첫 7일간 콘돔 병행 필요

    생리와 상관없이 바로 시작 (Quick start):
    - 임신 가능성이 없다고 판단되면 시작 가능
    - 첫 7일간 콘돔 병행 필수
    - 임신 여부가 불확실하면 2-3주 후 임신 테스트 권장

    ## 치료 목적(PCOS, PMS)
    - 가능하면 생리 첫날 시작이 가장 무난
    - 치료 목적에서는 생리 첫날이 아니어도 시작하는 경우가 많음
    - 이 경우에도 초기 7일은 추가 피임이 필요할 수 있음
    """

    // MARK: - 우울감 대응 가이드

    static let depressionGuidelines = """
    # 피임약 복용 후 우울감

    피임약에 들어 있는 호르몬 변화로 인해 일부 사람에서는 기분 저하, 우울감, 의욕 감소 같은 증상이 나타날 수 있습니다.

    ## 흔한 증상인가요?
    - 복용 초기 1-3개월 동안 기분 변화나 우울감이 나타나는 경우가 있음
    - 대부분은 시간이 지나면서 완화
    - 일부에서는 지속되거나 악화될 수 있음

    ## 상황별 대응

    A. 가벼운 기분 저하:
    - 평소보다 조금 우울함
    - 일상생활은 가능
    - 잠, 식사에 큰 변화 없음
    -> 2-3주 정도 경과 관찰 가능

    B. 일상에 영향이 있음:
    - 이유 없이 자주 울고 싶음
    - 무기력해서 일학업이 힘듦
    - 불안, 짜증이 눈에 띄게 증가
    -> 의료진 상담 권장, 약 변경이나 중단 고려

    C. 즉시 도움 필요:
    - 죽고 싶다는 생각
    - 자해 충동
    - 극심한 불안공황
    - 이전보다 우울이 급격히 심해짐
    -> 즉시 병원 방문 또는 1393(자살예방 상담전화)

    ## 도움이 될 수 있는 방법
    - 복용 시간을 취침 전으로 조정
    - 충분한 수면과 규칙적인 식사
    - 카페인알코올 줄이기
    - 지금 약 이름과 증상 시점을 기록해 두기

    ## 중요한 점
    - 피임약으로 인한 우울감은 개인차가 매우 큼
    - 다른 성분의 피임약으로 바꾸면 기분 부작용이 사라지는 경우도 많음
    - 증상을 혼자 참을 필요는 없음
    """

    // MARK: - 약물 변경 고려 기준

    static let switchingGuidelines = """
    # 피임약 변경을 고려할 수 있는 상황

    ## 1. 2-3개월 이상 지속되는 부작용
    다음 증상이 복용 2-3개월 이후에도 지속:
    - 우울감, 기분 저하
    - 불안, 짜증 증가
    - 성욕 감소
    - 지속적인 두통
    - 유방통, 유방 긴장감
    - 메스꺼움이 일상에 지장
    -> 다른 성분의 피임약으로 변경 고려

    ## 2. 일상 기능에 영향
    - 무기력으로 일상 유지가 어려움
    - 감정 기복이 커서 관계에 문제 발생
    - 수면식사 패턴이 눈에 띄게 변화
    -> 변경 상담 권장

    ## 3. 정신건강 관련 신호
    - 과거 우울증 또는 공황장애 병력
    - 피임약 시작 후 우울 증상이 명확히 악화
    - 이전에는 없던 감정 둔화, 무감동
    -> 피임약 변경 또는 중단을 의료진과 상의

    ## 4. 출혈 패턴 문제
    - 점상출혈파탄출혈이 3주기 이상 지속
    - 출혈량이 많아 일상 불편
    - 원래 규칙적이던 주기가 지속적으로 흐트러짐
    -> 제형 변경 고려

    ## 5. 피부체액 관련 불만
    - 여드름 악화
    - 체액 저류(부종)
    - 체중 변화가 지속적으로 불편
    -> 프로게스틴 종류가 다른 피임약으로 변경 고려

    ## 6. 복용 편의성 문제
    - 휴약 기간마다 불안
    - 자주 복용을 잊음
    - 일정이 불규칙해 시간 유지가 어려움
    -> 24+4 제형 또는 연속 복용 제형 변경 고려

    ## 중요 안내
    - 피임약 부작용은 개인차가 큼
    - 한 약이 안 맞아도 다른 약은 잘 맞는 경우가 흔함
    - 불편을 참고 버티는 것이 정답은 아님
    """

    // MARK: - Helper 메서드

    /// 복용 누락 시간에 따른 가이드라인 반환
    static func getMissedPillGuideline(delayHours: Double, cycleDay: Int) -> String {
        if delayHours <= 12 {
            return """
            **12시간 이내 누락**

            - 즉시 1정 복용
            - 다음 정제는 평소 시간에 복용
            - **피임 효과 유지**
            """
        }

        // 12시간 초과
        if cycleDay >= 1 && cycleDay <= 7 {
            // 1주차
            return """
            **12시간 초과 누락 - 1주차**

            - 잊은 마지막 정제 즉시 복용 (2정 동시 복용 가능)
            - 이후 정상 복용
            - **7일간 콘돔 병행 필수**
            - 이전 7일 내 성관계 있었다면 임신 가능성 안내
            """
        } else if cycleDay >= 8 && cycleDay <= 14 {
            // 2주차
            return """
            **12시간 초과 누락 - 2주차**

            - 잊은 마지막 정제 즉시 복용
            - 직전 7일간 정상 복용했으면 추가 피임 불필요
            - 그렇지 않거나 2정 이상 누락 시 → **7일 차단피임**
            """
        } else {
            // 3주차
            return """
            **12시간 초과 누락 - 3주차**

            휴약 없이 조정 필요:

            선택 ①
            - 잊은 마지막 정제 즉시 복용
            - 현재 포장 종료 후 **휴약 없이 새 포장 시작**

            선택 ②
            - 현재 포장 중단
            - 누락일 포함 7일 휴약 후 새 포장 시작

            ※ 이후 첫 휴약기에 출혈 없으면 임신 가능성 고려
            """
        }
    }

    /// 상황별 가이드라인 검색
    static func getGuideline(for topic: Topic) -> String {
        switch topic {
        case .missedPill:
            return missedPillGuidelines
        case .vomitingDiarrhea:
            return vomitingDiarrheaGuidelines
        case .contraindications:
            return contraindicationsGuidelines
        case .emergencySymptoms:
            return emergencySymptoms
        case .drugInteractions:
            return drugInteractionsGuidelines
        case .basicUsage:
            return basicUsageGuidelines
        }
    }

    /// 가이드라인 주제
    enum Topic {
        case missedPill
        case vomitingDiarrhea
        case contraindications
        case emergencySymptoms
        case drugInteractions
        case basicUsage
    }
}
